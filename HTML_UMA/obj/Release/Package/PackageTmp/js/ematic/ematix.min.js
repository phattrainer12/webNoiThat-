!function(){function urlIsExternal(t){return 0==t.indexOf("http")&&0!=t.indexOf(window.location.protocol+"//"+window.location.host)}function urlShouldTrigger(t){if(t.indexOf("ematicjs")!=-1||urlIsExternal(t))return!1;for(var e=window.location.protocol+"//"+window.location.host,r=0==t.indexOf("http")?t.substring(e.length):t,a=0;a<cartSearch.length;a++)if(cartSearch[a].test(r))return!0;return!1}function urlIsCheckout(t){if(urlIsExternal(t))return!1;for(var e=0;e<checkoutSearch.length;e++)if(checkoutSearch[e].test(t))return!0}function sendCheckout(){window.ematicSentCheckout||(ematics("log","product","checkout",ematicData.products),window.ematicSentCheckout=!0)}function loadCart(){var oReq=new XMLHttpRequest;oReq.addEventListener("load",function(){var start=this.responseText.indexOf("|||"),end=this.responseText.lastIndexOf("|||"),responseText=this.responseText.substring(start+3,end),data;data="object"==typeof JSON&&"function"==typeof JSON.parse?JSON.parse(responseText):eval(responseText),cartsAreEqual(ematicData.products,data)||(ematicData.products=data,ematics("log","product","cart",ematicData.products))}),oReq.open("GET",ematicData.url),oReq.send()}function cartsAreEqual(t,e){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!productsAreEqual(t[r],e[r]))return!1;return!0}function productsAreEqual(t,e){return t.id==e.id&&t.quantity==e.quantity&&t.price==e.price}for(var cartSearch=[],checkoutSearch=[],i=0;i<ematicData.cartSearch.length;i++)cartSearch[i]=new RegExp(ematicData.cartSearch[i].replace("*",".*")+"$","i");for(var i=0;i<ematicData.checkoutSearch.length;i++)checkoutSearch[i]=new RegExp(ematicData.checkoutSearch[i].replace("*",".*")+"$","i");window.ematicSentCheckout=!1,function(t){XMLHttpRequest.prototype.open=function(){var e=arguments[1];urlShouldTrigger(e)?this.addEventListener("load",loadCart):urlIsCheckout(e)&&this.addEventListener("load",sendCheckout),t.apply(this,arguments)}}(XMLHttpRequest.prototype.open),urlIsCheckout(window.location.href)&&sendCheckout()}();





